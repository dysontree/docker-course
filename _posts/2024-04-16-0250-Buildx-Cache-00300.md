---
layout: article
---
BuildKit расширяет поле собираемых объектов. Теперь это не образ, а артефакт. Артефакт собирается командой `docker buildx build`, при этом формат выходного объекта зависит от параметра `--output type`. Этот параметр назначает exporter для сборки.

```
docker buildx build --output type=image .
```

Это создаст локальный образ. Всё как обычно.

```
docker buildx build --output type=registry
```

Тоже самое, но после сборки отправит в репозиторий. Похоже на классический `docker image build --push`. Но отличие в том, что в эту команду можно задать множество параметров, которые будут влиять на процесс сборки и отправки артефакта.

Эти два варианта работают с драйвером сборки `docker`. Также с ним доступны экспортеры `local` и `tar`, которые сохраняют файлы образа или их tarball в локальную директорию.

OCI и Docker exporters не работают с дефолтным драйвером. Для них подойдёт, например, `docker-container`. Эти экспортеры важны для управления кэшем, с ними работают дополнительные возможности.

Для ускорения других сборок, BuildKit поддерживает экспорт своего локального кэша сборки во внешнее расположение. Таким образом мы можем выгружать его в свои будущие сборки. Подобный внешний кэш требуется в средах сборки CI/CD, поскольку далеко не всегда следующая стадия пайплайна исполняется на этом же раннере. Также кэш этой сборки может быть очищен, пока следующая стадия стоит в очереди. Обычно среды в CI/CD не хранят состояние, и нам приходится или явно сохранять сборочный кэш, или откуда-то получать. Также нам важно, чтобы задания на сборку исполнялись как можно быстрее.

Для работы с кэшем в драйвере по умолчанию есть механизмы `inline` и `local cache`.

- inline встраивает кэш сборки в собираемый образ из другого локального образа.
- local: записывает кэш сборки в локальный каталог файловой системы.
- registry: встраивает кэш сборки в отдельный образ и помещает его в отдельный реестр.
- gha: отправляет кэш в GitHub Actions cache.
- s3: загружает кэш сборки в S3-bucket.
- azblob: загружает кэш в хранилище BLOB-объектов Azure.

На момент написания этой главы последние две опции ещё не реализованы. 

Для примера у нас команда сборки приложения:
