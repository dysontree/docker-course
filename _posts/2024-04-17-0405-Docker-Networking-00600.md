---
layout: article
---

В некоторых случаях ни один из этих вариантов нас не устраивает. Но мы можем запустить контейнер вообще отбросив сетевую изоляцию, которую предлагает Docker. 

Скажем у нас есть единственный сервис в Docker, который тянет большой объем трафика. Но мы не готовы отказываться от `docker-proxy` для других контейнерных служб хоста. Решением будет запустить такой контейнер с опцией `--net=host`, что позволит ему работать в обход Docker в части сети. Надо понимать, что этим мы отходим от стандартного подхода, и нам придётся отдельно следить за этим контейнером, т.к. он стал особенным. Ну и следует учесть риски безопасности - в твоей организации это может быть не разрешено.

Запущу контейнер с сетевыми утилитами в пространстве хоста:

```
docker run -it --net host nicolaka/netshoot
```

Я оказался внутри контейнера. Мой хост называется `ubuntu`, и я вижу, что моё приглашение не изменилось. Это потому, что когда мы запускаем контейнер с опцией `--network=host`, у нас исчезает сетевая изоляция и изоляция UTS namespace. Поэтому из контейнера я вижу имя своего хоста. Однако работа из такого контейнера не совсем то же самое, что прямая работа с хоста.

Командой mount мы можем посмотреть, что именно Docker `подсунул` в контейнер, чтобы организовать изоляцию:

```
mount | grep vda
```

Получается, что за файлами `resolv.conf`, `hostname` и `hosts` всё еще следит Docker, т.е. они не являются файлами хоста. Если мы внесём изменения на хосте, они не затронут контейнер.

Давай посмотрим на сетевые интерфейсы:

```
ip a
```

А что с открытыми файлами? Из контейнера мы можем видеть сокеты работающих служб хоста.

```
ss | grep docker
```

Итак, мы действительно находимся в пространстве имен сети сервера. Это значит, что если бы мы запустили сетевую службу с высокой пропускной способностью, мы могли бы получить от неё максимально возможную производительность сети, поскольку здесь нет оверхеда механизмов изоляции. Но это также означает, что мы можем создать ситуацию, когда запущенные нами приложения начнут конфликтовать с уже используемыми портами сервера. Поэтому нам придется иметь это в виду и заняться менеджментом портов самостоятельно.

Ок, это всё о механизмах сети в Docker. Теперь давай посмотрим, какими командами это настроить. Жду тебя на следующей лекции.
