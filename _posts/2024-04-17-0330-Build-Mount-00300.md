---
layout: article
---
Я закомментирую инструкцию `COPY` и перепишу `RUN` для использования bind-монтирования времени сборки. Dockerfile-2:

```
FROM alpine
WORKDIR /src
#COPY key.json cloud-key.json

RUN --mount=type=bind,source=key.json,destination=cloud-key.json \
    ls -al > ls.txt

CMD [ "ls", "-al" ]
```

Снова соберу образ и запущу.

```
DOCKER_BUILDKIT=1 docker build -f Dockerfile-2 -t test-2 .
```

```
docker container run test-2
```

С виду ничего не изменилось, за исключением того, что внутри образа нет слоя `COPY`, а чувствительная информация передавалась в слой `RUN`. Еще обрати внимание, что я явно не удалял файл `cloud-key.json` из примонтированной директории. Все файлы из подобных монтирований нельзя удалить или изменить изнутри сборочного процесса, а после завершения сборки они автоматически будут убраны из образа.

Чтобы проверить, что ключ действительно был внутри в момент сборки, можно вывести созданный в инструкции `RUN` файл `ls.txt`.

```
docker container run test-2 cat ls.txt
```

Таким образом, в момент сборки он был доступен внутри инструкции `RUN`, но после ее завершения исчез. Если бы мы захотели, то могли бы скопировать его в другой файл внутри сборки, и тогда он остался бы в образе.

Подобные монтирования мегаудобны. Кроме перспективы безопасности, т.е. примера которой я привёл здесь, это помогает в автоматизации и повышает производительность. Мы можем подключать в подобные папки свои скрипты, которые могут настраивать образы нужным манером, можем уходить от занимающих слои инструкций `COPY` и `ADD` или организовывать собственные кэши пакетов для приложений. Все зависит от твоих потребностей.
