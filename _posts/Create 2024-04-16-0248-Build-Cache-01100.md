---
layout: article
---
Я верну все как было. И напоследок последняя хорошая практика для работы с установкой пакетов в Dockerfile. Наша инструкция с apt-get пока еще не совершенна. Мы убрали проблему просроченных пакетов, но это можно сделать лучше.

```
FROM  	ubuntu

RUN  	apt-get  update  \
&&  apt-get  install  -y  \
        	python3  \
        	python3-dev  \
         	python3-pip=22.0.2+dfsg-1 \
     	&&  apt-get clean \
     	&&  rm -rf /var/cache/apt/archives /var/lib/apt/lists/*

RUN  	pip3  install  flask==2.2.3

COPY  	app.py  /opt/app.py

ENTRYPOINT  FLASK_APP=/opt/app.py flask run --host=0.0.0.0 --port=5000
```

Дело в том, что списки apt достаточно объемные, а использованы они будут только единожды, в момент установки пакетов Python. Все остальное время они будут лежать в образе мёртвым грузом, занимать место и бесполезно пересылаться по сети. Логичным решением было бы удалить их в рамках того же слоя, чтобы они не попадали на хранение в конечный образ. Мы можем этого добиться. 

Для очистки скачанных пакетов в apt есть команда `apt-get clean`. Также удалим все индексы пакетов, просто стерев все файлы из директории списков. Добавим эти команды во вторую инструкцию через цепочку команды, как ты видишь. 

```
docker  image  build  .  -f  Dockerfile-no-clean  -t  no-clean
```

```
docker  image  build  .  -f  Dockerfile-with-clean  -t  with-clean
```

```
docker image list
```

Теперь, прежде чем зафиксировать слой, Docker удалит все списки пакетов, что освободит место. Мы сэкономили около 40Мб. Такой мусор может накапливаться от слоя к слою и в финальном образе создавать большой оверхед. Но если придерживаться такой методики, мы от него избавимся. Это является одной из лучших практик, не забывай про неё.

Ну вот и все в этой лекции. Увидимся в следующей.
