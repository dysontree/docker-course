---
layout: article
---
Как бы не был удобен этот подход, у него есть ограничение в том, что он берёт данные только из контекста сборки. Для чувствительных значений это не всегда подходит. Мы бы хотели получать это из отдельного файла вне директории сборки или из переменной окружения docker-хоста. 

Чтобы обрабатывать конфиденциальные данные в Docker есть монтирование типа `secret`. Оно позволяет обойти ограничения каталога сборки.

```
RUN  --mount=type=secret,id=my-cloud-key,destination=cloud-key.json  \
            ls  -al  >  ls.txt 
```

Как и ранее, мы указываем в инструкции `RUN` монтирование, его `type=secret`. Отличие здесь в том, что у него нет `src`, но взамен появился `id`. 

```groovy
docker  image  build  --secret  id=my-cloud-key,src=key.json  -f  Dockerfile  -t  test  .
```

Это потому, что исходный файл с креденшилс мы передаём на этапе сборки в параметре `--secret`. Здесь мы указываем `id` и `src`, чтобы при сборке Docker понял, к какому секрету какой исходный файл относится. Также мы можем передать не только файл, но и переменную своего окружения, она также появится в виде файла и будет доступна только в этой инструкции. Такой подход позволяет нам отвязать свои секреты от сборочных каталогов. Отметь для себя, что механизм кэширования плохо с этим работает, поэтому при изменении данных с доступом кэш может отработать неверно.

Вторая проблема (ну почти проблема) - это не работает без BuildKit. Старый билдер так не умеет. В свою очередь, у BuildKit собственная модель безопасности в которой есть ограничения времени сборки. Например, в ней во время билда не получится полноценно запустить собственный dockerd или containerd внутри собираемого образа. Таких кейсов немного, и тут на помощь приходит старый билдер или альтернативные методы создания образа из контейнера, например `docker commit`, который мы обсуждали ранее. На самом деле, создатели Docker активно работают над BuildKit, и с экспериментальными командами мы уже можем поднять привилегии сборщика. 

Ок, это всё, надеюсь было не сложно. Увидимся!
