---
layout: article
---
Итак, мы успешно собрали образ без ошибок и уверены что слои содержат именно то, для чего они предназначены. Каждый из слоёв закэширован и готов к переиспользованию, если это потребуется. Теперь, если мы снова запустим `docker image build`, как Docker будет принимать решение, может ли он использовать кэш для слоя или нет?

Ок, первое, на что Docker посмотрит - это на набор инструкций в Dockerfile. Пока внутри этого файла ничего не изменилось, Docker продолжит использовать слои из кэша.
Таким образом, если мы не вносили изменения в Dockerfile или другие файлы-аналоги Dockerfile, то сборка пройдет с полным использованием кэша. Ни один из слоев не будет пересобран, а операция сборки будет длиться всего несколько секунд после запуска.

Тут маленькая справка. Современные версии Docker могут принимать инструкции по сборке не только в виде инструкций Dockerfile, но и в других форматах сборки. Например, в формате `Procfile`. Это достигается использованием директивы `# syntax=...` в начале файла инструкций. В дальнейшем под термином `Dockerfile` я также имею ввиду все поддерживаемые файлы инструкций.

Если Dockerfile был изменён, т.е. не сам файл, а какая-то инструкция в нем была изменена, Docker Builder изменит свое поведение.
Например, в четвертой инструкции мы изменили версию пакета для установки. После этого кэш этого слоя становится недействительным. Тоже самое происходит и со следующими за ним слоями. Их кэши становятся недействительными, и слои также подвергнутся пересборке. Это важный момент, что при изменении слоя весь кэши следующих слоев становятся недействительными и перестраиваются. Это очень частое поведение, и ты постоянно с этим встречался.
