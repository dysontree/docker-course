---
layout: article
---

- Во-первых, убрать лишние файлы. Даже так, исключить добавление лишних файлов. Образы должны быть максимально тонкие и не содержать управляющих программ. Это также касается базовых образов для сборок.

Дальше будет видео, в котором я немного расскажу, почему тонкие образы - это хорошо. Дополнительно почитай про `distroless` и `chainguard` images, а также про подход с `slimtoolkit`.

- Во-вторых, убрать всю конфиденциальную информацию из образа. Если она нужна при сборке, то нельзя сохранять её между слоями. Для этого откажись от `COPY` и `ADD` для чувствительных данных. Есть альтернативы, которые работают в рамках одного слоя: передача по внутренней сети, монтирование времени сборки, копирование из предыдущей сборки при многоэтапном подходе. Также исключи хардкодинг токенов, паролей и т.д. внутри Dockerfile.

Не успокаивай себя, что у тебя приватный реджистри и вход только `для своих`. Сотрудники периодически меняются, доступы утекают в сеть и т.д. Если у тебя долгоживущие данные для доступа - им в образе делать нечего.

- В-третьих, это `.git`. Он не должен появляться в образе.

Также убедись, что продуктовые образы не содержат Dockerfiles, описаний CI-конвейеров и другой технической информации. Настрой для них `.dockerignore`.

- В-четвёртых, при создании образа стоит подумать, какие привилегии нужны для работы приложения, какой пользователь будет исполняться в контейнере и какие разрешения нужны для этого.

Это проще сказать, чем сделать, особенно если над образом работает много людей. Даже у крупных компаний, где должны работать профессионалы, в образах есть подобные проблемы.

- В-пятых, внедри Sec-инструменты для автоматической проверки на уязвимости на этапе сборки.

Также не забывай про методику SBOM, чтобы знать из чего состоит твой образ.

- В-шестых, перед развертыванием неплохо проверить, является ли образ тем, за кого себя выдаёт.

Для этого в Docker есть функция подписи образов.

И это всё, о чём я хотел напомнить. Увидимся!
