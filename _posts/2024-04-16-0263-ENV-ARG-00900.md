---
layout: article
---

Ок, мы рассмотрели несколько кейсов для применения переменных при сборке образа. `ENV` хорошо подходят для создания дефолтных настроек приложения, а `ARG` прекрасно справляются с заданием определённых параметров во время сборки. Но для чего они оба не подходят - это для передачи чувствительной информации в образ.

Давай соберем такой образ:

```
FROM alpine:3.19
ARG AWS_SECRET_KEY="54321"
ENV YC_SECRET_KEY="12345"
RUN apk add curl
ENV YC_SECRET_KEY="none"
```

Как видишь, мы закинули в образ конфиденциальные данные, а далее позаботились о том, чтобы значения ключей не было в контейнере. 

Мы рассуждали так: поскольку `ARG` живет только в время сборки, то его значений не будет внутри контейнера. От опасного значения в `ENV` мы также избавились - просто перетёрли его значением `none` в последнем слое, который после установки `curl`. Соберем этот образ:

```
docker image build -t test .
```

После сборки поищем скрытые креденшелс.

```
docker container run test env
```

```
docker image inspect  test
```

На первый взгляд всё как надо, мы не видим проблем ни при запуске контейнера, не при инспектировании его образа.

Но если заглянуть в слои контейнера при помощи `history`, мы увидим все секретные значения в открытом виде, откуда их может забрать любой, у кого есть доступ к образу.

```
docker history test
```

Как работать с секретами при сборке в безопасной манере мы поговорим чуть позже в теме хранения, а в данный момент нам нужно понимать отличия переменных времени сборки от переменных времени исполнения.

Это всё, увидимся!
