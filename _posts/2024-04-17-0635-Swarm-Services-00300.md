---
layout: article
---

Как же именно это работает? Давай еще раз посмотрим на это, но более детально.

Когда мы запускаем команду `docker swarm create` для создания трех экземпляров `httpd`, оркестратор менеджера определяет, сколько задач (`tasks`) создавать. Далее планировщик решит, на какие узлы поставить эти tasks. Он оценит загрузку загрузку нод, учтёт ключи, что мы передали в CLI, а также возьмёт во внимание настройки самого кластера.

Такой task, назначенный на хост, представляет собой процесс, который запускает реальные экземпляры контейнера. Каждый task связан с отдельным контейнером, и менеджер отслеживает статусы заданий и обновляет их в своей базе. Поскольку база распределённая, все остальные менеджеры также знаю о положении дел в кластере. В случае, если контейнер сломался, task также фейлится. Соответственно и менеджер узнаёт об этом и через свои механизмы вновь планирует запуск нового task.

Кроме этих компонентов, внутри менеджера работают и другие, которые позволяют нашим командам становиться реальными контейнерами на хостах.

После того, как мы запустили команду в своём CLI она превратилась в HTTP-запрос. Она приходит на менеджер и попадает на сервер API. Таким образом, сервер API получает наши инструкции. Отправителем может быть CLI или какая-то графическая оболочка для Docker. Мы можем сделать вызов даже через утилиту `curl`.

Затем инструкция передается оркестратору (`Orchestrator`). Оркестратор, как мы уже говорили, создает задачи. Он сравнивает желаемое состояние с состоянием в кластере. В нашем случае, он решает создать новый task.

Далее включается `Allocator`. Он выделяет IP-адреса для tasks.

После этого `Scheduler` увидит, что появилось новое задание. Он проверит, какие узлы доступны, и есть ли на них ресурсы для исполнения. Далее он оценит выбранные узлы и выберет лучший.

Диспетчер (`Dispatcher`) — это компонент, который непосредственно общается с узлами по поводу их состояния. Каждый узел сообщает ему, сколько ресурсов имеет, сколько контейнеров запущено и как они поживают и т.д. Также диспетчер периодически опрашивает узлы, чтобы быть уверенным, что узел живой и работает. Итак, основная роль диспетчера — пересылать tasks на узлы для исполнения. Увидев назначенное задание, он отправит его на ноду.
