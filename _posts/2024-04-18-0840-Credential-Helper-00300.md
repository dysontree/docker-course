---
layout: article
---

Под капотом команды происходит следующее:

- Сначала пользователь передаёт данные для аутентификации в CLI Docker
- CLI отправляет их в движок Docker, где они преобразуются в зашифрованный запрос к целевому реджистри
- Движок получает ответ от сервера и передаёт его в CLI

После успешной аутентификации, данные о доступе реджистри помещаются в файл `~/.docker/config.json` (в Windows другое размещение).

```
{
"auths": {
    "cr.yandex": {
      "auth": "anNvbl9rZXk6ew...0tXG4iCn0="
    },
    "eu.gcr.io": {
      "auth": "X2pzb25fa2V...29tIgp9"
    },
    "https://index.docker.io/v1/": {
      "auth": "cGFzc3...dvcmQK"
    },
    "quay.io": {
      "auth": "cm90b3Jv...Y2xvdWQK"
    }
  }
...
```

Так происходит на локальном docker-хосте. Если у нас кластер, то нам придётся скопировать этот файл на каждый хост, чтобы демоны этих узлов могли скачивать приватные образы. Но это так себе решение. Тут Swarm выручит нас, поскольку мы можем передать данные об аутентификации прямо в стек или swarm-службу при помощи параметра `--with-registry-auth`. Этим мы избавимся от хранения креденшелс на рабочих нодах.

Тем не менее, файл `~/.docker/config.json` будет создан на той машине, откуда мы делали `docker login`, и креденшилс будут хранится в нешифрованном виде. Т.е. все, у кого есть доступ к этому файлу на нашем лептопе, может их просмотреть.
