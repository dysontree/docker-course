---
layout: article
---
Напоследок, в BuildKit есть функция `bake`. 

```
docker buildx bake
```

Это инструмент автоматизации при помощи которого можно написать сценарий и управлять сборками и их параметрами из одного места. Принимает описания в `HCL`, `JSON` и `YAML-compose` форматах. 

В файле мы описываем `groups` и `targets`. Цель - это отдельная сборка, у неё обычно есть свой Dockerfile. Группы представляют собой коллекцию целей. 

Когда мы запускаем `buildx bake`, Docker начинает собирать все targets из group в параллельном исполнении. Мы можем указать файл при помощи `-f`, а  если не сделаем этого он будет искать файлы `docker-compose` и `docker-bake`.

В репозитории я написал простой сценарий, который собирает три образа, ты можешь запустить его, если захочешь. Он управляется файлом `docker-bake.hcl`, в котором единственная группа собирает три цели: `lb`, `app` и `db`. Я не буду углубляться в его разбор, там всё просто.

```
DOCKER_BUILDKIT=1  docker  buildx  bake
```

```
docker image ls
```

На моём опыте я редко встречаю такое в работе. Буквально видел один раз в виде части мультиплатформенного пайплайна для Github Actions. Там был монорепозиторий с несколькими сервисами, и из нескольких Dockerfiles в параллели собиралось несколько образов. В РФ разработчики как правило ничего не знают о `bake` и реализуют управление сборками через make-сценарии или скрипты оболочки. В кейсах с несколькими образами скрипты не раскрывают весь потенциал сборщика, поскольку это работает в последовательной манере и не использует все преимущества BuildKit.

Ок, это всё в теме про знакомство с BuildKit, где попробовал подсветить основные особенности сборщика. Как видишь, это очень крутая штука. Двигаемся дальше, увидимся!
