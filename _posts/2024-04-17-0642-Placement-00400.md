---
layout: article
---

Для того, чтобы Swarm учитывал метки при размещении службы нам нужно указать это в опции `--constraint` при создании или обновлении службы.

```
docker  service  create  --constraint=node.labels.type==cpu-optimized  video-processing
```

Эта опция принимает пару ключ-значение в качестве аргумента, в которой мы указываем название метки, установленной на ноде и то, с чем должно совпасть её значение, чтобы узел был принят к назначению. В этом примере мы указали, что на узле должна быть метка `type` в значении `cpu-opitmized`. Такой же подход можно использовать для других рабочих нагрузок, таких как наша база данных. Мы также создадим службу, но укажем тип в `memory-opitmized`.

```
docker  service  create  --constraint=node.labels.type==memory-optimized  database
```

Планировщик будет назначать только на ноды с таким условием. Но это не гарантирует назначение, поскольку на этих промаркированных нодах могут быть другие контейнеры, которые занимают необходимые ресурсы, мешая назначить новую нагрузку. Чтобы запретить другим службам размещаться на непредназначенных для них узлах, мы можем использовать отрицательно условие в ключе `--constraint`:

```
docker  service  create  --constraint=node.labels.type!=cpu-optimized  --constraint=node.labels.type!=memory-optimized  webserver
```

Теперь наш webserver будет назначен на любую ноду кластера, кроме тех, что имеют данные метки. Это очень мощный механизм, который позволяет нам гибко расставлять нагрузки внутри кластера, повышая его эффективность.

Кроме меток есть другие параметры, которые можно передать в опцию `--constraint`. После создания кластера планировщик будет назначать нагрузки на как воркеров, так и на менеджеров. Он не имеет запрета на такую операцию. Мы можем изменить данное поведение, указав во флаге ограничений встроенное свойство `role`, как ты видишь:

```
docker service create --constraint=node.role==worker webserver
```

Теперь служба `webserver` будет создана на одной из рабочих нод кластера, у которой хватает ресурсов для её работы. На менеджеры её контейнеры уже не попадут.
