---
layout: article
---

Мы можем создать создать собственную оверлейную сеть при помощи команды `docker network create`, указав драйвер как `overlay`.

```
docker network create --driver overlay custom-overlay-network
```

Аналогично, мы можем установить диапазон оверлейной подсети, используя опцию `--subnet`.

```
docker network create --driver overlay --subnet 10.15.0.0/16 custom-overlay-network-1
```

Такое может потребоваться, если у нас есть конфликт с IP-адресацией или мы не хотим использовать сеть по умолчанию. У созданных нами сетей есть ещё одна особенность - её можно сделать `attachable`.

В сети по умолчанию, т.е. которая создаётся при инициализации кластера, только контейнеры, созданные как часть swarm-служб, могут быть к ней подключены. Но очень часто нам требуется чтобы swarm-контейнеры работали с отдельными docker-контейнерами, к которым Swarm не имеет отношения. Для этого есть атрибут `--attachable`.

```
docker network create --driver overlay --attachable custom-overlay-network
```

Теперь контейнеры, созданные отдельно от Swarm смогут подключиться к этой оверлейной сети и получить её преимущества.

Также по дефолту весь трафик управления swarm-службами (`controlplane`) зашифрован AES-алгоритмом. Но это не касается трафика приложений (`dataplane`). Чтобы также зашифровать данные, передаваемые приложениями, добавь флаг `--opt encrypted` при создании оверлейной сети.

```
docker network create --driver overlay --opt encrypted custom-overlay-network-3
```

Шифрование dataplane не включено по умолчанию, поскольку создаёт большой оверхед. Обязательно замерь производительность перед включением шифрования трафика приложений и сравни его. Обычно потеря в производительности около 10%, но на твоих нагрузках это может отличаться.

Чтобы прикрепить свою службу к собственной сети укажи пaраметр `--network` при создании службы:

```
docker service create --network custom-overlay-network-3 rotorocloud/webapp
```

Работа с overlay-сетью особенно не отличается от других сетей в Docker. Чтобы удалить свою оверлейную сеть, мы также используем команду `docker network rm`.

```
docker network rm custom-overlay-network
```

Команда `network prune` уберёт все неиспользуемые сети.

```
docker network prune
```
