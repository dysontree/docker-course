---
layout: article
---

Итак, приглядимся внимательно: наша сборка заняла 2 два этапа:
-   сначала мы собираем пакет с помощью YARN
-   и далее мы помещаем его в образ для дальнейшего развертывания в продакшене

Ок, время идет и мы развиваем своё приложение. Каждый раз, когда мы вносим свои изменения, мы вновь создаём своё приложение при помощи команды `yarn build`, далее запускаем `docker image build` и на выходе получаем docker-образ, который отлично работает.

Однако не все так уж хорошо, поскольку сборка самого приложения происходит локально, на машине разработчика. В данный момент все в порядке, но пакеты и библиотеки, доступные на сервере и используемые для сборки приложения в какой-то момент устареют, а мы забудем их обновить. И в этот момент мы получим проблемы в своей сборке. Разумеется, мы сможем привести всё в порядок и наладить дальнейший процесс, но на это также уйдёт время.

Кроме этого, если мы захотим в будущем создать другой девелоперский сервер, на котором будут трудится дополнительные разработчики, то нам нужно будет убедиться, что в нём мы настроили в точности такую же уникальную конфигурацию установленных библиотек, пакетов и инструментов, что все функции работают точно также, как и на старом сервере разработки. Т.е. старый и новый сервера должны максимально совпадать. Поддерживать такие конструкции нелегко - нам постоянно нужно будет быть уверенными, что оба сервера совпадают.

Лучшее решение в такой ситуации - использовать `docker build` не только для контейнеризации, но и для процесса сборки dist-пакета. Поэтому вместо того, чтобы собирать непосредственно в среде своего сервера, мы напишем еще один Dockerfile и будем собирать наше приложение в контейнерной сборочной среде. 

Итак, при помощи Dockerfile я контейнеризировал процесс сборки пакета приложения.

```
FROM node

COPY . ./

RUN yarn install
RUN yarn build
```

В файле я использовал образ `node` с Docker Hub. Это основной образ nodejs. В следующей инструкции я копирую в образ все файлы из каталога приложения, а затем устанавливаю зависимости с помощью команды `yarn install`. После того, как зависимые пакеты nodejs подтянутся, я запущу команду сборки приложения - `yarn build`.

```
docker image build -f builder.Dockerfile -t builder .
```

Прямо скажем, перед нами не самый оптимизированный вариант, но я хочу оставить всё это максимально простым и понятным. 

Итак, запуск первого этапа создает чистую сборку моего приложения. При каждом запуске команды сборки Docker будет пересобирать этот образ. Также мы можем запустить эту сборку на любом сборочном сервере, и оно будет собираться везде одинаково.
