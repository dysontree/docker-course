---
layout: article
---

Итак, мы стали примерно представлять, что происходит в кластере, а если происходит проблема, то мы можем её отловить и отреагировать. Но это по прежнему сложно уместить в голове. В графическом представлении это заходит лучше. 

Есть несколько полезных инструментов, которые умеют рисовать графики. Например, `cAdvisor`. Он может собирать метрики хоста и контейнеров. Он поставляется в виде контейнера. Чтобы запустить его используем такую команду:

```
docker container run --volume=/:/rootfs:ro \
--volume=/var/run:/var/run:ro \
--volume=/sys:/sys:ro \
--volume=/var/lib/docker/:/var/lib/docker:ro \
--volume=/dev/disk/:/dev/disk:ro \
--publish=8080:8080 \
--detach=true \
--name=cadvisor \
--privileged \
--rm \
--device=/dev/kmsg \
gcr.io/cadvisor/cadvisor:latest
```

Он может рисовать графики, что помогает отслеживать тенденции и строить какой-то прогноз. Веб-интерфейс доступен на порту `8080`.

Для получения информации в машиночитаемом виде есть API:

```
curl -s http://172.30.1.2:8080/api/v2.1/machine/ | jq
```

Это на самом деле большой шаг вперёд, но все равно есть проблемы. У cAdvisor очень короткая память. И он нигде не хранит старую информацию. Поэтому мы видим то, что происходит здесь и сейчас, но что было неделю назад cAdvisor не помнит. На самом деле, он может записывать собираемые метрики в разные time-series базы, вроде InfluxDB, Prometheus и т. д. Но редко кто доходит до такого, поскольку есть более продуманные решения для полного цикла мониторинга.

Я говорю о системах вроде Prometheus. Он состоит из нескольких компонентов: из агентов, которые собирают метрики на хостах, из service discovery, которая взаимодействует через API Docker и находит нагрузки и узлы кластера, из внутреннего хранилища метрик и из менеджера оповещений. Это модульная система. Например, когда база становится слишком большой, мы можем подключить внешнее решение. Также если у нас несколько Prometheus, мы можем объединить их для общей работы.
