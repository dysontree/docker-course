---
layout: article
---

Периодически нам будет требоваться выполнить обслуживание на узлах, например, применить какие-то патчи, установить обновления или перезагрузить сервер. Также нам может требоваться периодически перезапускать службу docker, чтобы он почистился от лишнего мусора. Если мы перезапустим наш сервер, все контейнеры с приложениями будут остановлены, что приведёт к простою нашего приложения и затронет наших пользователей. 

Хороший способ избежать этого - перестать назначать нагрузки на ноду, а далее по одному убирать контейнеры на другие узлы, чтобы у приложений не было простоя. Когда нода освободится, мы можем провести запланированные операции. В этом нам поможет команда `docker node update` с настройкой `drain`.

```
docker  node  update --availability drain worker-0
```

Это защитит узел от новых нагрузок и переместит контейнеры с нагрузкой с `worker-0` на `worker-1`. Здесь нужно отметить момент, что перенести именно те контейнеры, что работают сейчас на `worker-0` прямиком на `worker-1` нельзя. Они будут последовательно уничтожены на `worker-0` и воссозданы на `worker-1`. Поэтому это будут не совсем одинаковые контейнеры, просто созданные по одному шаблону.

Команда `docker node ls` покажет нам, что доступность у ноды `worker-0` теперь в `Drain`. Это означает, что swarm-планировщик не будет размещать на этом узле какие-то свои контейнеры, и этот узел доступен для выполнения обновлений или каких-то других задач. Если мы запустим команду `docker container ls`, мы можем увидеть, как контейнеры эвакуируются с ноды. Отметь для себя важный момент. Были выселены только те контейнеры, которыми управляет swarm. У тебя также могут быть запущены другие контейнеры через обычные команды Docker. Swarm за ними не следит и управляет только своими службами, поэтому нам придётся заботиться об отдельностоящих контейнерах самостоятельно.
