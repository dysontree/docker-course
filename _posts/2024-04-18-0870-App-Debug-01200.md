---
layout: article
---

Ранее мы обсуждали, что созданный контейнер располагается на хосте в директории `/var/lib/docker/containers/`.
Там будет находиться директория с таким же именем, как ID контейнера. Там мы можем найти файлы логов и файлы, которые изменились в процессе работы контейнера.

```
sudo ls -lh /var/lib/docker/containers/c19ef7ecb4ba208734065ec96533cca06aa4ab665b70eb0da58a2b504871bcb7
```

Этот каталог также может быть очень полезен в случае серьезного сбоя. Даже если Docker перестал отвечать или хостовая операционная система неработоспособна, мы можем установить, что происходило в контейнере, опираясь на логи и изменённые файлы. Также мы можем посмотреть конфигурацию контейнера, в ней в том числе содержится, какие были монтирования с хоста в контейнер. Анализ содержимого этих файлов может дать нам дополнительную информацию.

Как мы говорили, Docker работает во многоуровневой файловой системе со слоями. Основные файлы принадлежат образам, а контейнеры содержат только те файлы, которые изменились после их старта. Очень частая проблема приложений в том, что они создают или меняют какие-то файлы, которые им менять вообще не нужно. В установлении этого нам поможет инспектирование директории контейнера, поскольку там мы сразу увидим все разночтения относительно образа контейнера. Также это полезно в случае расследования инцидентов безопасности - по этим файлам мы можем установить, как именно злоумышленник двигался к цели.

Для обнаружения различий есть инструмент в CLI - команда `docker container diff`.

```
docker container diff nginx-debug
```

Каждая строка в выводе начинается с буквы `A` или `C`, что является сокращением от `Added` и `Changed` соответственно. Мы видим, что в этом контейнере с nginx была изменена куча файлов, поскольку я устанавливал туда `tcpdump` и несколько раз делал в него exec оболочкой `bash`. Если мы запустим это для нового контейнера, то увидим, что меняется лишь файл конфигурации, а также добавляется каталог `/var/cache/nginx`, который хранит временные файлы.

Эта команда даёт возможность узнать, как используется файловая система контейнера и может быть очень полезна, когда мы пробуем оптимизировать работу контейнера и усилить его безопасность. 

Например, в контейнере вроде `nginx` мы можем установить основную файловую систему в `readonly` и смонтировать директории `/var/cache/` и `/etc/nginx` как `tmpfs`. Это даст очень хорошие показатели по безопасности и поднимет производительность. Мы делаем подобные упражнения в курсе безопасника Kubernetes, и если тебе интересно, пройди тот курс. Но предупреждаю, он не для слабаков!

Ок, по мере погружения в технологию ты будешь использовать разные уловки для дебага, пентеста и защиты своих контейнеров и хостов. Это были основные вещи. 

Не всем требуется погружаться в эти техники всесторонне, но без этого не получится правильно работать с контейнерными нагрузками в продакшене: либо приложения будут работать плохо, либо твои серверы будет трясти, либо тебя взломают. Либо всё вместе. Если ты разработчик и от тебя не зависят сервера с Docker, то можешь на этом не зацикливаться. 

А на этом всё, увидимся!
