---
layout: article
---
Ок, если нам нужно опубликовать порты контейнера, но не указывая явно, какие именно порты? До сих пор мы указывали порт `5000`. Но что, если мы не хотим его указывать? Скажем, в контейнере есть приложения, работающие на нескольких портах, и мы просто хотим, чтобы все порты, на которых работает служба, были доступны на каких-то портах docker-хоста. Нам не важно на каких, просто пусть Docker использует свободные. 

```
docker  container  run -d  -P  rotorocloud/webapp
```

Для этого мы используем опцию с `-P`, т.е. с заглавной буквой P. Таким образом, с помощью опции с заглавной буквой `P` нам не нужно указывать номера портов при запуске контейнера. Но как эта опция понимает, какой именно порт использовать? Понятно, что в случае внешнего порта выбирается случайный номер для эфемерного диапазона. Но как Docker узнаёт, в какой порт в контейнере ему прицеливаться? Это где-то определено?

Разные приложения могут запускать свои службы на разных портах. В момент сборки образа разработчик точно знает, какие из них потребуются. Поэтому при запуске такого контейнера Docker ориентируется на инструкцию `EXPOSE` из Dockerfile. Т.е. информация об этих портах закладывается на этапе создания образа. И именно так Docker об этом узнает. Перед тобой Dockerfile:

```
EXPOSE 5000
```

Вот здесь в самом конце находится инструкция `EXPOSE`. В ней мы указали порт, на котором будет работать наше приложение, и это `5000`. Теперь флаг `-P` будет знать, какие порты публиковать. Многие не понимают до конца функции инструкции `EXPOSE`. Многие додумывают, что она открывает нужный порт. Но это не так. Она не открывает порты, а уведомляет Docker, что в случае использования функции публикации на случайном порту хоста нужно брать информацию отсюда. 

Но что, если разработчик забыл добавить такую инструкцию, или образ старый и там не предусмотрена такая особенность? Мы можем добавить дополнительные порты, которые не были указаны в Dockerfile, используя опцию `--expose` при запуске контейнера, как ты видишь. 

```
docker  container  run -d  -P  --expose 8080  rotorocloud/webapp
```

Чтобы узнать, какие порты выставлены мы можем обратиться к команде `docker container inspect` и просмотреть параметр Ports.

```
docker  container  inspect e4b7
```

Как видишь, Docker принял во внимание то, что было в Dockerfile - порт `5000`, а также опубликовал заданный в командной строке `8080`.

Для того, чтобы узнать, есть ли инструкция EXPOSE в образе, воспользуемся командой `image inspect` и посмотрим в разделе `ExposedPorts`. Там будут перечислены порты, которые указаны в самом образе.

```
docker  image inspect rotorocloud/webapp | grep -A 2 Exp
```
