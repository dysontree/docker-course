---
layout: article
---
```
docker buildx build --push -t <registry>/<image> \
  --cache-to type=inline,ref=<registry>/<cache-image>[,parameters...] \
  --cache-from type=local,src=path/to/local/dir .
```

`-cache-from` позволяет нам загрузить кэш из предыдущей сборки, а `--cache-to` сохранить новый кэш для следующих. Также мы можем указать `--target`, чтобы загрузить кэш для определенной стадии мультибилда. Мы пока не добрались до многоэтапных сборок, поэтому на данном этапе достаточно понять, что кэш можно взять из образов другого реджистри и использовать его в своих сборках.

Итак, эти два механизма для разных целей:

- `cache-to` и `cache-from` используются для сохранения результата шагов сборки и повторного использования из в будущих сборках, что позволяет избежать необходимости повторной сборки слоя. Кэш хранится в постоянном месте вне сборщика, например, в реджистри, а другие сборщики могут скачать кэш и просто пропустить ранее завершенные шаги сборки. Т.е. они могут не иметь образа в локальной системе, но все равно использовать кэш.
- `--mount type=cache` создает монтирование внутри временного контейнера, который выполняется в инструкции `RUN`. Файлы из этого монтирования повторно используются при последующих выполнениях сборки. Это полезно, когда на шаге есть множество внешних зависимостей, которым нужно присутствовать в образе и которые можно безопасно переиспользовать между сборками. Это хранилище кэша является локальным для сборщика и представляет собой пустой каталог при первом использовании.
