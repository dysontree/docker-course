---
layout: article
---

Когда Docker создает образы, он создает их в многоуровневой архитектуре. Каждая строка инструкций создает новый слой в образе Docker, в котором сохраняются только изменения относительно предыдущего слоя.

Например, на первом уровне у нас были лишь файлы базовой ОС Ubuntu. На втором при помощи инструкции `RUN` был создан новый слой, в котором были обновлены списки утилиты `apt`. Таким образом слой номер 2 будет содержать лишь новые файлы, которые были добавлены или изменены, относительно слоя номер 1. И размер слоя будет равен объему тех файлов, что изменились в системе относительно первого шага.

Затем третья инструкция создает третий слой с пакетами Python и PIP. Как и в прошлый раз в нем содержаться лишь те файлы, что были добавлены или изменены относительно шага номер 2. Т.е. лишь эта разница или эта дельта. 

За ним следует четвертый уровень, в котором уставливаются пакеты Python. Если какой-то из пакетов уже существовал в предыдущих слоях, но он обновляется в этом, то сохранится и его старая версия в более раннем слое, и более поздняя в новом.

Далее пятый слой, который копирует наш исходный код. В пятом слое у нас лежат только файлы с нашим кодом, поскольку файлы операционной системы не изменялись. 

В последнем слое, который обновляет точку входа образа, новые файлы не добавляются. Здесь будут внесены изменения в метаданные образа, поэтому этот слой будет иметь размер равный `0`.

Поскольку каждый слой сохраняет только изменения от предыдущего слоя, это очень хорошо отражается на размере. Если мы посмотрим на базовый образ Ubuntu, его размер составляет около 80 МБ. Пакеты apt, которые я устанавливаю, весят около 400 МБ, а остальные слои небольшие. Мы можем увидеть эту информацию, если запустим команду `docker history` за которой следует имя образа.
