---
layout: article
---
Мы также должны оптимизировать порядок своих инструкций, чтобы максимально эффективно использовать встроенный кэш. То, как сейчас выглядит файл, является хорошим примером. В этом случае наша новая инструкция по установке пакетов, относящихся к Python, выполняется один раз. Следующий слой, который требует зависимостей Python, также выполняется единожды. После слои укладываются в кэш. Мы вряд ли будем менять эти инструкции слишком часто. Но вот что может меняться очень часто - это код нашего приложения на Python. Это может происходить несколько раз в день. Таким образом, при изменении файла приложения слои 4 и 5 также будут перестроены. Но это очень небольшие изменения, и они займут минимум времени на пересборку.

```
FROM  ubuntu

COPY  app.py  /opt/app.py

RUN  apt-get  update  \

     &&  apt-get  install  -y  \
         python3  \
         python3-dev  \
         python3-pip=22.0.2+dfsg-1

RUN  pip3  install  flask

ENTRYPOINT  FLASK_APP=/opt/app.py  flask  run  --host=0.0.0.0  --port=5000
```

Теперь предположим, что я переместил инструкцию копирования вверх, как ты видишь. В этом случае наш образ все также будет успешно построен. И приложение в нем будет работать, как ожидалось. Но вот время на сборку значительно увеличится, поскольку каждый раз, когда в код будут внесены любые, даже самые незначительные изменения, все следующие уровни кэша станут недействительными, и их придется пересобирать. В итоге, мы опять будем вынуждены собирать пакеты, зависимости Python и т.д. Это будет пустой тратой времени, вычислительных ресурсов и ресурсов сети.

Поэтому помни, что то, что чаще всего изменяется, следует располагать в конце Dockerfile, а те инструкции, что меняются редко, имеет смысл вынести в начало, в верхнюю часть файла.
