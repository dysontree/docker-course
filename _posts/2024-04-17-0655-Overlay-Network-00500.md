---
layout: article
---

Когда Docker Swarm инициализируется, то по умолчанию создает оверлейную сеть с названием `ingress`. Ты можешь увидеть её в выводе `docker network ls` после создания кластера. Обрати внимание, что она отличается от других сетей: у неё драйвер `overlay`, а область действия `swarm`. Давай подробнее поговорим о ней.

```
docker network ls
```

Ранее мы узнали о том, что такое публикация портов или порт-маппинг. Вот здесь у нас веб-сервис, который работает на порту `5000`. 

```
docker container run -d -p 80:5000 rotorocloud/webapp
```

Для внешнего пользователя, чтобы достигнуть этот веб-сервис, мы должны выставить порт контейнера на порт docker-хоста. В этом случае мы делаем маппинг порта `5000` контейнера на порт `80` хоста. После этого, пользователь сможет обратиться к веб-серверу, используя URL хоста с портом 80.

Это работает нормально с одним контейнером, и нам это легко понять. Но в режиме кластера это работает немного иначе. Представим, что у нас однонодный swarm-кластер. С одной нодой проще понять, что именно там происходит. Мы создаём новую службу веб-сервера. У нас будет две реплики и аналогичная публикация портов с `80` на `5000` в контейнере.

```
docker service create --replicas 2 -p 80:5000 rotorocloud/webapp
```

Поскольку у нас единственный узел, оба экземпляра запустятся на этом же хосте рядом друг с другом. У них разные приватные IP-адреса во внутренней сети, но одинаковый порт 5000, который они пробуют привязать к порту 80 хоста. Разумеется, так сделать не получится, поскольку порт одновременно может слушать одно приложение. Нам нужна некоторая прослойка, которая бы отделила 80 порт хоста от дополнительных портов контейнеров и смогла бы понять, какой трафик направлять в контейнер с адресом `172.17.0.2`, а какой в `172.17.0.3`. Как видишь это очень похоже на балансировщик нагрузки.
