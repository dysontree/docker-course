---
layout: article
---

Это будет выглядеть как локальное зеркало реджистри. После мы можем направить туда все наши docker-демоны. Само зеркало будет проксировать запросы на Docker Hub, а ответы сервера кешировать в локальном хранилище. Запрос следующего потребителя на образ, который уже сохранён в кэше, не будет отправлен в интернет. Ему будет отгружен локальный образ. Таким образом, мы решаем проблему лимитов, а также экономим интернет-трафик компании. Если контент под запрашиваемым тегом в центральном реджистри изменился, зеркало примет это к сведению, скачает и закэширует последнюю версию контента.

Самый простой вариант добиться этого - запустить образ `registry`. В настройках указать пользователя с Docker Hub, от имени которого будет скачиваться образ (это нужно, чтобы поднять limit rate до 200), его пароль (или личный токен) и REMOTEURL `https://registry-1.docker.io`, как ты видишь:

```
docker run -d -p 80:5000 --restart=always --name=throught-cache -e REGISTRY_PROXY_REMOTEURL="https://registry-1.docker.io" -e REGISTRY_PROXY_USERNAME="rotorocloud" -e REGISTRY_PROXY_PASSWORD="1234567890qwertyuiop" registry
```

Теперь нужно перенастроить docker-демоны потребителей на работу с зеркалом. Нужно внести изменения в файл конфигурации, указав адрес хоста в локальной сети и перезапустить службу docker:

```
{
  "registry-mirrors": [
    "http://docker-registry-mirror.corp.local/"
  ]
}
```

Какой диск выбрать зависит от загрузки зеркала. Работая в режиме кэша, реджистри будет периодически очищать себя от мусора, который появляется из-за устаревших слоёв. Дополнительные настройки можно передать через yaml-файл. Подробности смотри в документации [https://docs.docker.com/docker-hub/mirror/](https://docs.docker.com/docker-hub/mirror/).

Обрати внимание, что нет возможности зеркалировать другой реестр, кроме Docker Hub. Также обрати внимание, что частные репозитории юзера, которого мы указали при старте контейнера, также станут доступны потребителям.

Альтернативно, если ты точно знаешь, какие образы нужны в сборочных циклах компании, можно просто их скачать вручную и поместить в свой локальный корпоративный частный реестр. Это может быть лучше с точки зрения безопасности.

И это всё, увидимся!
