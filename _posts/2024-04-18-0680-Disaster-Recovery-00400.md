---
layout: article
---

Для устойчивости мы должны добавить в кластер два дополнительных узла-менеджера. Теперь, когда в кластере уже три менеджера, кворум равняется двум. Чтобы продолжать работать, кластеру необходимо минимум два узла. Т.е. один менеджер может отвалиться не вызывая проблем.

Итак, это очень важное преимущество, если один из менеджеров выходит из строя, но кластер всё ещё имеет достаточный кворум для продолжения нормальной работы. В таком состоянии мы можем спокойно разобраться, что там произошло и вернуть упавший узел. Если на нем продолжает работать служба Docker, и она не повреждена, то узел может автоматически вернуться в кластер. Но если произошло что-то непоправимое, и мы уверены, что узел не вернётся, можно просто добавить дополнительного менеджера в кластер или повысить существующий рабочий узел.

Если вдруг сломались два узла-менеджера, то в кластере не будет достаточного кворума, и административная деятельность прекратится, пока не наберётся достаточно управляющих нод. Точно также, лучшим решением будет восстановить вышедшие из строя узлы. С одним менеджером у нас не получится повысить существующего воркера, поскольку это тоже административная задача, а кворума в данный момент нет. Поэтому самый простой вариант - выяснить, что произошло и попробовать вернуть ушедшие узлы обратно.

Если эти попытки ни к чему не привели, то единственный оставшийся вариант - это принудительно создать новый кластер на узле менеджера, который остался онлайн. Для этого есть команда:

```
docker swarm init --force-new-cluster
```

После этого старый кластер будет уничтожен, а вместо него появится новый с одним менеджером, которым будет этот самый узел. Вышедшие из строя узлы уже не являются его участниками, однако он сохранил прошлую информацию о своих объектах, например, какие службы там были, какие рабочие узлы, сети и т.д.

Теперь кворум стал равен единице, и мы можем принимать любые решения. Стоит сразу добавить дополнительные узлы-менеджеры или сделать promote для рабочих узлов, чтобы кластер стал устойчивым.

Как видишь, после пересоздания кластера мы не утратили нагрузки. Восстановившись таким образом, мы не потеряли наш кластер в части развернутых там приложений. Но почему так произошло? И как Docker отделяет слой управления от слоя приложений?
