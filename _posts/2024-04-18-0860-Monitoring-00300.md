---
layout: article
---

Сначала `docker stats`. Эта команда показывает статистику контейнеров на этой ноде. Это хорошее место, откуда стоит начать, если мониторинга совсем нет, а информацию о состоянии получить нужно. Это напоминает команду `top` в Linux. Она также периодически обновляется, но если нужно, мы можем получить значения один раз по ключу `--no-stream`.

```
docker run -d --health-cmd='stat /etc/passwd || exit 1' --name nginx nginx
```

Мы запустили контейнер с простой пробой здоровья и получили его статистику.

```
docker stats --no-stream
```

В выводе мы видим список контейнеров, сколько ресурсов они потребляют (вместе с ограничениями на ресурс), данные по сети, по вводу-выводу и количество процессов внутри. По этой таблице мы быстро можем разобраться, если где-то настроили неверные ограничения.

Самая ценная информация здесь - состояние памяти, поскольку OOM-killer приходит за контейнерами, вышедшими за лимит, и уничтожает их. Таким образом, если приложение часто падает без причины, стоит смотреть в эту сторону. 

Вторая нужная опция - количество процессов. Если приложение создаёт лишние процессы, это быстро броситься в глаза.

Мы можем снимать эти данные напрямую с API-сервера Docker. Здесь я делаю это через сокет, поскольку в моей настройке демон слушает только на нём:

```
curl -s --no-buffer -X GET --unix-socket /var/run/docker.sock http://docker/containers/nginx/stats | jq
```

Я обрезал вывод, но там действительно много информации. Как я сказал, когда информации много, это очень полезно.
