---
layout: article
---

Мы создали первый источник данных для Prometheus, теперь нам нужно создать и настроить сам сервер Prometheus. Его мы разместим в виде контейнера, но сначала нужно создать конфигурационный файл:

```
vi prometheus.yaml
```

```
# Чтобы проверяло каждые 5 секунд и дадим название монитору 'stats-monitor'
global:
  scrape_interval: 5s
  external_labels:
    monitor: 'stats-monitor'

# Мы определили job `DockerStats`, которая обращается к IP-адресу хоста на порт метрик `9393`.
# localhost не сработает, поскольку с точки зрения Prometheus, локальным будет хост его контейнера
scrape_configs:
  - job_name: 'DockerStats'
    static_configs:
    - targets: ['172.30.1.2:9323']

```

Мы поместим его в `/tmp/prometheus/prometheus.yaml`. 

Теперь запустим контейнер:

```
docker container run --rm -d -p 9090:9090 \
-v ${PWD}/prometheus.yaml:/etc/prometheus.yaml \
prom/prometheus --config.file=/etc/prometheus.yaml

```

Это запустит контейнер и смонтирует туда файл с конфигурацией, которую мы создали. Благодаря ему Prometheus найдёт настройки, необходимые для мониторинга нашего docker-хоста.

Когда всё запустится, на порту `9090` будет опубликован сервер Prometheus, в котором в разделе `Graph` мы можем создать promql-запрос и получить заказанную выборку метрик.

Это супер-базовый сетап. Если хочешь узнать больше о Prometheus, у меня в планах сделать подобный курс на Роторо. Там будет много интересного.

Напоследок о платных вариантах. Всё, о чём мы говорили, было бесплатно и открыто. Есть проприетарные решения. Очень неплохое от `New Relic`, ещё лучше от `Datadog`. Настраивается легко, работает устойчиво и т.д., поскольку все проблемы уже решены за нас. Мониторинг дорогой сам по себе, но с платными вендорами это становится сильно дорого. Хорошим выбором является подключение облачного провайдера. Обычно их решения по мониторингу направлены на свои облачные экосистемы, но они предоставляют возможность мониторить и сторонние нагрузки, а данные хранить в их облачном хранилище. Это может быть хорошим вариантом по соотношению `цена/качество`.

Что же, тема мониторинга неисчерпаемая, а в нашей лекции это всё. Увидимся!
