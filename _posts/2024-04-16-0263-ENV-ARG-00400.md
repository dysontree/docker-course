---
layout: article
---

Итак, в нашем Dockerfile мы воспользовались особенностью, что прописанные в инструкции `ENV` значения намертво фиксируются в образе. Эти значения видны командой `inspect`.

```
docker image inspect rotorocloud/simple-webapp-rockets:big | grep ENV
```

Но что, если переменная нужна только в процессе сборки, а в дальнейшем она не требуется? Или нам вообще нежелательно, чтобы она там находилась? 

Для случая, если переменная нужна только во время сборки в Docker есть инструкция `ARG`. В отличие от `ENV`, значения этих переменных окружения существуют только во время сборки, и они не попадают в финальный образ. 

Вот пример multistage-сборки, в котором от одного родительского образа мы собираем временный образ с тестами внутри, и, если он успешно их прошёл, то во второй стадии мы собираем такой же образ. Этот образ уже без тестов, и он готов для развертывания на серверах.

Еще раз, в первом этапе сборки у нас присутствует каталог `/opt/app/tests`, который не нужен в производственном образе. Поэтому вторая стадия собирает без этого каталога. Если тесты в первой стадии провалятся, то вся сборка упадёт. Этим мы уверены, что продуктовый образ соберётся только если тесты успешно пробежали.

```
ARG 		PYTHON_PARENT_TAG="3.8-alpine"

FROM 		python:${PYTHON_PARENT_TAG}

RUN 		pip  install  flask

COPY 		app  /opt/app

COPY 		tests  /opt/app/tests

RUN  		/opt/app/tests/tests.py test



FROM 		python:${PYTHON_PARENT_TAG}

RUN 		pip  install  flask

COPY 		app  /opt/app

EXPOSE 		8080

WORKDIR	/opt/app

ENTRYPOINT 	[  "python3", "app.py"  ]
```

Чтобы родительские образы были одинаковыми, мы определили `AGR`-переменную сборки `PYTHON_PARENT_TAG` со значением `3.8-alpine` и использовали ее по ходу билда. Теперь, если мы захотим изменить родительский образ, нам будет достаточно поменять инструкцию `ARG`. 

Таким образом, инструкция `ARG` помогает нам упростить работу во время сборки, а во время работы контейнера она не нужна.
