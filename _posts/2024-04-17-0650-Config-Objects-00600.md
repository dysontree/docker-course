---
layout: article
---

Ок, мы создали config, который по умолчанию создаёт файл `nginx-conf` в корне файловой системы контейнера, и далее мы указали, куда его смонтировать внутри контейнера, чтобы он работал в правильном месте. Проходит время, и мы хотим обновить нашу конфигурацию. Для этого нам нужно несколько команд.

Сначала создадим новый config из другого файла `nginx-v2.conf`.

```
docker config create nginx-conf-v2 /tmp/nginx-v2.conf
```

Теперь отсоединим старый объект конфигураций от контейнеров работающих служб:

```
docker service update --config-rm nginx-conf p4o6to0ah50e
```

Это удаляет файл, смонтированный внутри всех контейнеров сервиса nginx. При этом он пересоздаст контейнеры службы. Теперь, когда объект не связан ни с одной из служб, мы можем его удалить:

```
docker config rm nginx-conf
```

Без отсоединения от служб это невозможно. Нельзя удалить используемый объект.

Теперь добавим новый объект к нашим службам.

```
docker service update --config-add src=nginx-conf-v2,target=/etc/nginx/nginx.conf p4o6to0ah50e
```

Это можно сделать одной командой, которая удалит старый файл и тут же добавит новый:

```
docker service update --config-rm nginx-conf-v2 --config-add src=nginx-conf-v3,target=/etc/nginx/nginx.conf p4o6to0ah50e
```

Это называется ротацией конфигурации. Имей в виду, что это не аналог `docker cp`, которая работает по сети. Swarm не удаляет старый файл и добавляет новый. Она пересоздаёт контейнеры с новым файлом.

Объекты `сonfig` доступны в Docker Compose и в Docker Swarm. Но в compose это работает по-другому. Полноценная работа данных механизмов, которая распространяет их на все узлы кластера, доступна только в swarm-режиме. При запуске контейнера в автономном Docker работать с config-объектами не получится.

И на этом всё, увидимся!
