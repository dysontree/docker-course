---
layout: article
---

Итак, docker-compose использует файлы YAML для описания микросервисов нашего приложения. Имя по умолчанию для YAML-файла сompose — `compose.yaml`. Отметь, что в старой версии это был `docker-compose.yml`. Если в директории нет `compose.y(a)ml`, то он запустит `docker-compose.y(a)ml`. Остальные файлы нужно передавать через флаг `-f`.

В следующем примере показан очень простой compose-файл, который описывает небольшое Flask-приложение с двумя микросервисами: `redis` и `rocketcounter`.

```
version: '3.0'

services:
  redis:
    image: redis
    networks:
      counter-net:
  rocketcounter:
    build: .
    ports:
    - 8085-8086:5000
    networks:
      counter-net:
    volumes:
    - counter-vol:/code

networks:
  counter-net:
  
volumes:
  counter-vol:

```

Приложение представляет собой простой веб-сервер, который подсчитывает количество кликов и сохраняет это значение в кэше Redis.

На первом уровне нашего файла есть четыре элемента: version, services, networks, volumes. Это не полный список, что может быть на первом уровне, но вот эти являются основными, и их ты будешь видеть чаще других.

`version` отвечает за язык конфигурации, для которого был разработан этот файл. Строго говоря, это пишется для человека, который будет читать и править файл. Современный docker-compose по инструкциям в файле должен самостоятельно понять, какая версия используется.

Далее службы - `services`. Обычно это самый большой раздел. В нем описываются микросервисы, составляющие приложение. В примере их два: `redis` и `rocketcounter`. Именно из этой секции compose узнаёт, какие контейнеры поднимать, какие дополнительные параметры сообщать контейнерам при запуске, какие переменные окружения устанавливать, к каким сетям подключать, какие порты требуется выставить на хост и куда смонтировать хранилище. Каждый такой сервис имеет собственный контейнер с приложением, но экземпляров службы может быть несколько. Т.е. docker-compose умеет масштабировать службы.

Следующая секция `networks` описывает, какие сети требуются для этого сетапа. Здесь мы можем задекларировать требования к сети. Мы можем указать, чтобы была создана новая сеть или подключена существующая.

Секция `volumes` говорит compose, какие тома нам требуются в этом развёртывании. Подобно как и для сети, мы можем указать свойство `external`, чтобы была использована существующая volume. Без этого свойства будет создан новый том.
