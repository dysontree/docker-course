---
layout: article
---

Итак, по мере прохождения курса мы погружались в запуск образов, в их создание, разбирались с хранением и c сетью в Docker. Теперь пришло время для развертывания приложений. 

Наши приложения обычно состоят из нескольких компонентов-служб, которые работают совместно. Обычно они работают в нескольких сетях и имеют как собственные, так и общие настройки. Еще им требуется получить конфиденциальные данные, организовать постоянные хранилища и т.д. Каждый раз настраивать такой сетап, вводя команды Docker, очень утомительно. Если их объединить в скрипт, то запускать становится проще, но вносить правки проще не становится. Также к этому скрипту нужен другой скрипт, который правильно опустит стек, поскольку криво положенный стек такая автоматика может и не запустить.

Обычно над проектами мы не работаем в одиночку. Поэтому удобнее иметь общий язык описания развертываний, который будут понимать все разработчики проекта. Скрипты оболочки на это мало подходят, но декларативный Yaml-документ с описанием компонентов приложения отлично прижился. Поэтому Docker внедрил этот проект. Такой файл может прочитать утилита docker-compose и при помощи Docker поднять желаемый стек приложений. Мы можем поделиться этим Yaml-файлом внутри команды, сохранить его в системе контроля версий, а далее провести оценку качества его написания и ещё более улучшить.

Инструмент `Docker Compose` является частью проекта Docker, и в первую очередь он предназначен для разработчиков. Docker Compose включен в официальную поставку и идёт в виде плагина. Его также можно поставить отдельно, если в твоей системе он отсутствует.

Тут небольшое замечание. Первоначально docker-compose представлял из себя отдельное приложение, оно было написано на Python и запускалось отдельной командой `docker-compose`. Эта утилита известна как docker-compose версии 1. В 2021 году она перестала обновляться, и её заменил Docker Compose версии 2. Этот идет уже в виде плагина к Docker CLI и написан на языке `Go`. Его запуск обычно доступен по команде `docker compose` - т.е. не через тире, а с пробелом. Старый вариант с `docker-compose` также возможен на некоторых системах.

Чтобы проверить, установлен ли он в твоей системе выполни команду:

```
docker compose version
Docker Compose version v2.17.3
```

Новый compose почти полностью понимает старые версии compose-файлов. Но он более строго относится к указанной в файле версии синтаксиса. При переходе я столкнулся, что он не хочет интерпретировать массивы переменных окружения, которые старый compose без проблем `пережёвывал`, поэтому мне пришлось переписать часть своих файлов. Также при создании служб новая версия использует в названиях тире (-) вместо подчёркивания (_). Все остальные отличия ты найдёшь в документации, но их там немного.

Давай рассмотрим поближе Yaml-файл `docker-compose.yml`.
