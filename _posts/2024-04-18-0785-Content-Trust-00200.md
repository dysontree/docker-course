---
layout: article
---

Чтобы поиграть с этим, ты можешь установить `Notary` в виде compose-файла и настроить её. Если тебе интересно поищи `Notary Server with Compose` в документации. Это поднимет базу, notary-server и signer. Имей в виду, что тебе потребуется приватный реджистри, создать сертификаты и т.д. На самом деле не самый лёгкий старт. Я бы для знакомства использовал Helm-chart, если под рукой есть Kubernetes.

Это было, если ты разворачиваешь сам. Но если ты работаешь с `Docker Hub`, то проблем вообще нет. Минус в том, что мы вынуждены полагаться на чужие корневые ключи. Для работы мы просто используем команду `docker trust`.

Сначала я скачаю образ и назову его `rotorocloud/custom-redis:v1`:

```
docker  image  pull  redis
```

```
docker tag redis rotorocloud/custom-redis:v1
```

Чтобы подписать docker-образ нам понадобится `delegation keypair`. Эта ключевая пара может быть сгенерирована локально или получена из центра сертификации.

Мы создадим ключ командой:

```
docker trust key generate rotoro
```

Теперь нужно отправить открытую часть ключа в Notary от Docker Hub. Этот ключ привязывается к репозиторию. В данный момент у меня не существует ни самого репо, ни каких-то административных ключей. Это всё Docker Hub создаст сам.

```
docker trust signer add --key rotoro.pub rotoro rotorocloud/custom-redis:v1
```

Теперь наш репо готов к работе с подписями и знает о существовании ключа `rotoro`, которому разрешено подписывать `rotorocloud/custom-redis:v1`.

Проверим, что наш локальный образ не содержит сигнатур:

```
docker trust inspect --pretty rotorocloud/custom-redis:v1
```

Теперь при помощи закрытого ключа я создаю подпись для образа. После процедуры подписи метаинформация будет отправлена на сервер.

```
docker trust sign rotorocloud/custom-redis:v1
```

Снова проверю подпись образа, теперь она присутствует. Как видишь мы подписали тег `v1` при помощи сигнера `rotoro`.

```
docker trust inspect --pretty rotorocloud/custom-redis:v1
```

По умолчанию Docker Content Trust отключен в docker-клиенте. Чтобы его включить, нужно установить переменную среды `DOCKER_CONTENT_TRUST` в значение `1`. В таком режиме Docker CLI не будет работать с образами, которые не содержат подписи.
