---
layout: article
---
При создании образа я оцениваю его с трех перспектив, и эти три направления взаимосвязаны:

- с точки зрения перфоманса, это о том как получилось оптимально его собрать по размеру, нет ли там лишних и замедляющих частей
- с точки зрения обслуживания - насколько хорошо образ вписывается в структуру образов компании и насколько легко ним будет работать другим сотрудникам
- с точки зрения безопасности - нет ли в образе чувствительных данных и запрещенных компонентов, а также чем мы пользовались при отлове проблем и уязвимостей, т.е. насколько хорош этот инструмент контроля.

Ок, кроме этих направлений, есть несколько общих рекомендаций. Начнём с того, что не стоит делать при контейнеризации приложений.

- Не создавай образы, объединяющие несколько приложений. Например веб-сервер, базу данных и кэш оперативной памяти не стоит собирать в один образ. Считается, что у контейнера должна быть одна функция. Соответственно и образ должен быть спроектирован с этой перспективы.

Лучший подход здесь - делать своё приложение модульным, разместить в разных образах по функциям и дать работать в отдельных контейнерах. Каждое приложение в образе будет иметь свои собственные библиотеки и зависимости, и нам не нужно будет стараться угодить им всем.
В разных образах у нас не будет проблемы с упаковкой таких зависимостей, а также с дальнейшим их обновлением. Но нам, как разработчикам, следует убедиться, что компоненты приложения, развернутые в виде контейнеров, умеют работать вместе, взаимодействовать друг с другом и образовывать одно большое приложение с разными сервисами. Также, каждый компонент должен уметь масштабироваться вверх или вниз по мере необходимости, и делать это независимо от других частей приложения.

- Второй момент, что не надо делать - это хранить постоянные данные или состояние приложения в контейнере.

Это связано с тем, что природа контейнеров эфемерна, и мы не должны беспокоится о их судьбе, если требуется уничтожить экземпляр или породить новый. При этом результат работы контейнера, т.е. данные его работы должны быть отделены от экземпляра, поскольку при смерти контейнера мы их потеряем. Поэтому всегда храни их либо на локальном внешнем томе, либо в СХД, либо в какой-либо службе кэширования, вроде Redis.
