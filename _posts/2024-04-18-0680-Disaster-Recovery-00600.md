---
layout: article
---

Предположим, что мы полностью потеряли весь управляющий слой нашего кластера: все менеджеры недоступны, а мы уверены, что они не подлежат восстановлению. Единственный выход - воссоздать новый кластер на новом узле из резервной копии.

Сначала мы создаем новый узел с таким же IP, как была у ноды, где мы его снимали. Устанавливаем туда Docker. Важно, чтобы Docker был той же версии, что и в бэкапе.
Далее останавливаем службу docker. Этим мы будем уверены, что он не вносит изменения в каталог `/var/lib/docker/`.

```
systemctl stop docker
```

На всякий случай проверим, чтобы не было старого каталога `swarm`:

```
rm -rf /var/lib/docker/swarm
```

```
mkdir /var/lib/docker/swarm
```

Разжимаем архив в каталог swarm.

```
tar -xvzf swarm-backup.tgz -C /var/lib/docker/swarm
```

Стартуем dockerd.

```
systemctl start docker
```

И наконец инициализируем новый кластер на базе резервной копии:

```
docker swarm init --force-new-cluster --advertise-addr 10.0.3.12:2377
```

Убедись, что выставил IP нужного интерфейса, как это было в предыдущем кластере.

Теперь у нас должен быть кластер из одного менеджера, и мы можем развить его до высокодоступного, добавив дополнительные управляющие узлы.

И это всё, увидимся в следующей лекции.
