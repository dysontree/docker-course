---
layout: article
---

В Docker доступны многоэтапные сборки. Эти `multi-stage builds` могут объединить наши три шага в один.

```
FROM node

COPY . ./

RUN yarn install
RUN yarn build

FROM nginx

COPY dist /usr/share/nginx/html

CMD [ "nginx", "-g", "daemon off;" ]
```

Итак, давай посмотрим, как с помощью многоэтапных сборок мы можем объединить инструкции обоих наших Dockerfiles в один. В начале я буквально соединю эти два файла в один. 

Теперь нам нужно понимать, где находятся наши этапы. Это можно отследить по инструкции `FROM`. Т.о., если в Dockerfile больше одной инструкции `FROM`, то это многоэтапная сборка. А количество этапов зависит от количества этих инструкций.

Сейчас у нас в этом Dockerfile находятся наши первый и третий этапы. Как ты помнишь, в первом из образа с `node` мы собирали `dist`, а в третьем в образ с nginx мы копировали папку с файлами. Здесь всё то же самое: сначала Docker исполнит те инструкции, что предназначались для блока `FROM node`, а после завершения начнёт работать над вторым заданием из блока `FROM nginx`. В итоге процесс сборки создаст два отдельных образа. 

```
docker image build -t my-dashboard .
```

Если мы запускаем это командой `docker build -t my-dashboard .`, то по окончанию работы мы получим образ с тегом `my-dashboard`, который фактически будет является сборкой второго образа. И в таком виде это будет не совсем то, что нам нужно. Мы забыли про ту часть, где мы копировали каталог из одного образа в другой. Сейчас мы это сделаем.
