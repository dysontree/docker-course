---
layout: article
---

Чтобы работать на нескольких хостах в режиме кластера, мы использовали Docker Swarm. С ним мы делали то же самое, что и с обычным Docker, но были отличия в командах. Вместо контейнеров мы стали оперировать наборами контейнеров или swarm-службами. Эти службы могут содержать по несколько экземпляров контейнера. Теперь не мы, а Swarm инструктирует демоны отдельных хостов, что именно они должны делать. Можно сказать, что команда `docker service create` аналог `docker container run`, только более масштабная. 

Могли бы мы провернуть с ней такой же трюк, как делали раньше, перейдя от `docker run` к `docker compose up`? Ответ `да`. 

В Docker Swarm есть механизм декларативного описания служб в виде compose-файла. Таким образом, мы можем преобразовать старые команды `docker service ...` в файл docker-compose, или правильнее сказать в stack-файл Docker.

После создания файла Docker Stacks, мы запускаем его при помощи команды `docker stack deploy` с указанием compose-файла через опцию `--compose-file` или короче `-c`.

```
docker  stack  deploy  --compose-file  deployment.yaml  web-app
```

Это поднимет стек в масштабе swarm-кластера. Теперь нам не нужно самим запускать эти команды по созданию служб, сетей, хранилищ и т.д. Настройки всего нашего приложения находится в одном stack-файле.

В этом случае оба файла `compose.yaml` и `deployment.yaml` выглядят одинаково, но во втором мы можем указать дополнительные инструкции, недоступные для обычного compose. Мы постепенно разберём некоторые возможности. Но прежде чем идти дальше, давай обсудим, что именно такое Docker Stacks, и какое место они занимают в экосистеме Docker.
